<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../ztop-web-socket/ztop-web-socket.html">

<script src="../../orderBy.js"></script>

<polymer-element name="ztop-process-cpu-info" attributes="cpuUsage maximumFrequency">
  <template>
    <link rel="stylesheet" href="assets/pure-min.css">
    <style>
      :host {
        display: block;
      }
    </style>
    <ztop-web-socket data="{{socketData}}"></ztop-web-socket>

    <table class="pure-table pure-table-bordered">
      <thead>
        <tr>
          <th>Name</th>
          <th>PID</th>
          <th>Status</th>
          <th>Threads</th>
          <th>% CPU</th>
          <th>% Memory</th>
        </tr>
      </thead>
      <tbody>
        <tr template repeat="{{process in socketData | hasCpuPercent | orderBy(['-cpu_percent', 'name'])}}">
          <td>{{process.name}}</td>
          <td>{{process.pid}}</td>
          <td>{{process.status}}</td>
          <td>{{process.num_threads}}</td>
          <td>{{process.cpu_percent}}</td>
          <td>{{process.memory_percent}}</td>
        </tr>
      </tbody>
    </table>
  </template>
  <script>
    Polymer('ztop-process-cpu-info', {
      cpuUsage: 0,
      maximumFrequency: 0,
      socketData: [],
      hasCpuPercent: function(processes) {
        return processes.filter(function(process) {
          return (typeof process.cpu_percent === 'number');
        }, this);
      },
      socketDataChanged: function() {
        var sum = 0;
        this.socketData.forEach(function (process) {
          sum += process.cpu_percent;
        });
        this.cpuUsage = Math.round(sum);

        // TODO use real value
        this.maximumFrequency = Math.floor(Math.random() * 151);
      }
    });
  </script>
</polymer-element>
