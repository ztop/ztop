<link rel="import" href="../../bower_components/polymer/polymer.html">

<script src="../../orderBy.js"></script>

<polymer-element name="ztop-process-cpu-info" attributes="cpuUsage maximumFrequency processData">
  <template>
    <link rel="stylesheet" href="assets/pure-min.css">
    <style>
      :host {
        display: block;
      }
    </style>

    <table class="pure-table pure-table-bordered">
      <thead>
        <tr>
          <th>Name</th>
          <th>PID</th>
          <th>Status</th>
          <th>Threads</th>
          <th>% CPU</th>
          <th>% Memory</th>
        </tr>
      </thead>
      <tbody>
        <tr template repeat="{{process in processData | hasCpuPercent | orderBy(['-cpu_percent', 'name'])}}">
          <td>{{process.name}}</td>
          <td>{{process.pid}}</td>
          <td>{{process.status}}</td>
          <td>{{process.num_threads}}</td>
          <td>{{process.cpu_percent}}</td>
          <td>{{process.memory_percent}}</td>
        </tr>
      </tbody>
    </table>
  </template>
  <script>
    Polymer('ztop-process-cpu-info', {
      cpuUsage: 0,
      maximumFrequency: 0,
      processData: [],
      hasCpuPercent: function(processes) {
        return processes.filter(function(process) {
          return (typeof process.cpu_percent === 'number');
        }, this);
      },
      processDataChanged: function() {
        var sum = 0;
        this.processData.forEach(function (process) {
          sum += process.cpu_percent;
        });
        var numCpus = Math.max(1, this.processData.length && this.processData[0].cpu_affinity.length);
        this.cpuUsage = Math.round(sum / numCpus);

        // TODO use real value
        this.maximumFrequency = Math.floor(Math.random() * 151);
      }
    });
  </script>
</polymer-element>
